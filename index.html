<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Humana Brasil • Identificação</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;800&display=swap" rel="stylesheet">
<style>
:root{--verde:#37954a;--laranja:#f07e2d;--cinza:#f5f7f8;--preto:#1a1a1a;}
body{margin:0;font-family:Montserrat;background:#fff;color:var(--preto)}
.wrap{max-width:720px;margin:24px auto;padding:24px}
.card{background:var(--cinza);border-radius:16px;padding:24px}
label{display:block;font-weight:600;margin:10px 0 4px}
input,select{width:100%;padding:12px;border:1px solid #d7dde2;border-radius:12px;font:inherit}
.btn{appearance:none;border:0;border-radius:14px;padding:14px 18px;
background:var(--laranja);color:#fff;font-weight:800;cursor:pointer;width:100%;margin-top:12px}
.hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1 style="color:var(--verde)">Identificação do Cliente</h1>
  <div class="card">
    <label>CPF</label>
    <input id="cpf" placeholder="000.000.000-00" inputmode="numeric" required>
    <button class="btn" onclick="consultarCPF()">Consultar CPF</button>

    <div id="cadastro" class="hidden">
      <h2>Novo cliente</h2>
      <label>Nome</label><input id="nome">
      <label>E-mail</label><input id="email" type="email">
      <label>Telefone</label><input id="telefone" inputmode="tel">
      <button class="btn" onclick="criarCliente()">Continuar</button>
    </div>
  </div>
</div>

<script>
async function consultarCPF(){
  const cpf=document.getElementById('cpf').value.replace(/\D/g,'');
  if(!cpf){alert("Informe o CPF.");return;}
  try{
    const r=await fetch("https://hook.us2.make.com/ltihpmu3xpwf9rkopifyfd3imdt9ahj1",{
      method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cpf})
    });
    const data=await r.json();
    if(data.idCliente){
      window.location.href=`escolha.html?idCliente=${encodeURIComponent(data.idCliente)}`;
    }else{
      alert("Cliente não encontrado, preencha os dados.");
      document.getElementById('cadastro').classList.remove('hidden');
    }
  }catch(e){alert("Erro na consulta.");}
}

async function criarCliente(){
  const cpf=document.getElementById('cpf').value.replace(/\D/g,'');
  const nome=document.getElementById('nome').value;
  const email=document.getElementById('email').value;
  const telefone=document.getElementById('telefone').value;
  if(!nome||!email){alert("Preencha todos os campos.");return;}
  try{
    const r=await fetch("https://hook.us2.make.com/aryvagl26r8dplz79j1nn3jlluc3vw6a",{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({cpf,nome,email,telefone})
    });
    const d=await r.json();
    if(d.idCliente){
      window.location.href=`escolha.html?idCliente=${encodeURIComponent(d.idCliente)}`;
    }else alert("Erro ao criar cliente.");
  }catch(e){alert("Erro no cadastro.");}
}
</script>
</body>
</html>

<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Humana Brasil • Escolha dos Itens</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;800&display=swap" rel="stylesheet">
<style>
:root{--verde:#37954a;--laranja:#f07e2d;--cinza:#f5f7f8;}
body{margin:0;font-family:Montserrat;background:#fff;color:#1a1a1a}
.wrap{max-width:720px;margin:24px auto;padding:24px}
header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
header img{height:56px;width:auto}
h1{margin:0;font-weight:800;font-size:1.4rem;color:var(--verde)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.item{display:flex;align-items:center;gap:10px;padding:8px;background:var(--cinza);border-radius:10px}
.item img{width:48px;height:48px;border-radius:8px;object-fit:cover}
.btn{appearance:none;border:0;border-radius:14px;padding:14px 18px;
background:var(--laranja);color:#fff;font-weight:800;cursor:pointer;width:100%;margin-top:16px}
.footer{margin-top:16px;font-size:.85rem;color:#4b5563;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <img src="logo-humana-1-1080x480.png" alt="Humana Brasil">
    <div>
      <h1>Monte sua cesta</h1>
      <p id="infoCesta">Carregando...</p>
    </div>
  </header>

  <form id="formItens">
    <div id="listaItens" class="grid"></div>
    <button class="btn" type="submit">Gerar pagamento</button>
  </form>
  <p class="footer">Ao confirmar, você será redirecionado ao link oficial do Asaas para pagamento seguro.</p>
</div>

<script>
// -------- PARÂMETROS DA URL --------
const params = new URLSearchParams(window.location.search);
const idCliente = params.get("idCliente");
const tipoCesta = params.get("cesta");

// -------- CONFIGURAÇÃO DAS CESTAS --------
let CESTA_TAMANHO = 6;
let VALOR_CESTA = 59.90;

if (tipoCesta === "12") { CESTA_TAMANHO = 12; VALOR_CESTA = 99.90; }
if (tipoCesta === "18") { CESTA_TAMANHO = 18; VALOR_CESTA = 139.90; }
if (tipoCesta === "assinatura") { CESTA_TAMANHO = 12; VALOR_CESTA = 99.90; }

const lista = document.getElementById("listaItens");
const info = document.getElementById("infoCesta");
info.textContent = `Escolha até ${CESTA_TAMANHO} itens para sua cesta.`;

// -------- CARREGAR LISTA DE PRODUTOS --------
// Você pode hospedar o arquivo produtos.json no mesmo servidor ou GitHub Pages
async function carregarProdutos() {
  try {
    const r = await fetch("https://SEU_DOMINIO/produtos.json");
    const produtos = await r.json();
    produtos.forEach(p => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <label>
          <input type="checkbox" name="itens" value="${p.nome}">
          <img src="${p.img}" alt="${p.nome}">${p.nome}
        </label>`;
      lista.appendChild(div);
    });

    // limita número de seleções
    document.querySelectorAll('input[name="itens"]').forEach(chk => {
      chk.addEventListener('change', limitarSelecao);
    });
  } catch (e) {
    alert("Erro ao carregar lista de produtos.");
  }
}

function limitarSelecao() {
  const marcados = document.querySelectorAll('input[name="itens"]:checked');
  if (marcados.length > CESTA_TAMANHO) {
    this.checked = false;
    alert(`Limite atingido: máximo de ${CESTA_TAMANHO} itens.`);
  }
}

carregarProdutos();

// -------- ENVIO DO FORMULÁRIO --------
document.getElementById("formItens").addEventListener("submit", async e => {
  e.preventDefault();
  const selecionados = [...document.querySelectorAll('input[name="itens"]:checked')].map(i => i.value);
  if (selecionados.length === 0) {
    alert("Escolha ao menos um item.");
    return;
  }

  const payload = {
    idCliente,
    valor: VALOR_CESTA,
    itens: selecionados,
    tipoCesta
  };

  try {
    const resp = await fetch("https://hook.us2.make.com/SEU_WEBHOOK_COBRANCA", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await resp.json();
    if (data.paymentLink) {
      window.location.href = data.paymentLink;
    } else {
      alert("Erro ao gerar link de pagamento.");
    }
  } catch (e) {
    alert("Erro de conexão com o servidor.");
  }
});
</script>
</body>
</html>
